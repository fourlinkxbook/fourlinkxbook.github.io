<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bookshelf Website with Escrow</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f9f9f9; }
    .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    form { margin-bottom: 20px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    input, select, textarea { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
    button { background: #4CAF50; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
    button:hover { background: #45a049; }
    .hidden { display: none; }
    .escrow { background: #fff8e1; padding: 15px; border-radius: 5px; margin-bottom: 15px; }
    .download { padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
    a.download-btn { background: #2196F3; color: white; padding: 10px 15px; border-radius: 5px; text-decoration: none; display: inline-block; margin-top: 10px; }
    a.download-btn:hover { background: #0b7dda; }
    .error { color: red; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Bookshelf with Escrow</h1>

    <!-- Book Upload Form -->
    <div id="upload-section">
      <form id="bookUploadForm">
        <h2>Upload a Book</h2>
        <label>Book Title*</label>
        <input type="text" name="title" required>
        <label>Author*</label>
        <input type="text" name="author" required>
        <label>Description*</label>
        <textarea name="description" rows="3" required></textarea>
        <label>Price*</label>
        <input type="number" name="price" step="0.01" required>
        <label>Select Book File (PDF)*</label>
        <input type="file" name="bookFile" accept=".pdf" required>
        <button type="submit">Upload and Proceed to Payment</button>
        <div id="uploadError" class="error hidden"></div>
      </form>
    </div>

    <!-- Escrow Section (Shows after validation, before payment) -->
    <div id="escrow-section" class="hidden">
      <div class="escrow">
        <h2>Book in Escrow</h2>
        <p>Your book has been validated and is ready for payment.</p>
        <p>Book: <span id="escrow-title"></span></p>
        <p>Author: <span id="escrow-author"></span></p>
        <p>Price: $<span id="escrow-price"></span></p>
        <button id="proceed-to-payment">Proceed to Payment</button>
      </div>
    </div>

    <!-- Payment Section -->
    <div id="payment-section" class="hidden">
      <div class="payment-form">
        <h2>Payment</h2>
        <form id="opayPaymentForm">
          <label>Card Type:</label>
          <select name="cardType">
            <option value="visa">Visa</option>
            <option value="verve">Verve Card</option>
            <option value="mastercard">MasterCard</option>
          </select>
          <label>Card Number</label>
          <input type="text" name="cardNumber" placeholder="1234 5678 9012 3456" required>
          <label>Expiry Date</label>
          <input type="text" name="expiryDate" placeholder="MM/YY" required>
          <label>CVV</label>
          <input type="text" name="cvv" placeholder="123" required>
          <button type="submit">Pay with Opay</button>
          <div id="paymentError" class="error hidden"></div>
        </form>
      </div>
    </div>

    <!-- Download Section (Shows after payment) -->
    <div id="download-section" class="hidden">
      <div class="download">
        <h2>Download Your Book</h2>
        <p>Thank you for your purchase!</p>
        <p>Book: <span id="download-title"></span></p>
        <p>Author: <span id="download-author"></span></p>
        <p>Price: $<span id="download-price"></span></p>
        <a href="#" id="download-link" class="download-btn">Download Book</a>
      </div>
    </div>
  </div>

  <script>
    // Book data and escrow state
    let escrowBook = null;

    // Book upload form
    document.getElementById('bookUploadForm').onsubmit = function(e) {
      e.preventDefault();
      const form = e.target;
      const title = form.title.value;
      const author = form.author.value;
      const description = form.description.value;
      const price = form.price.value;
      const bookFile = form.bookFile.files[0];

      // Validate data
      if (!title || !author || !description || !price || !bookFile) {
        document.getElementById('uploadError').textContent = 'Please fill in all required fields.';
        document.getElementById('uploadError').classList.remove('hidden');
        return;
      }

      // Simulate server-side validation and escrow
      escrowBook = {
        title, author, description, price, bookFile
      };

      // Show escrow section
      document.getElementById('upload-section').classList.add('hidden');
      document.getElementById('escrow-section').classList.remove('hidden');
      document.getElementById('escrow-title').textContent = title;
      document.getElementById('escrow-author').textContent = author;
      document.getElementById('escrow-price').textContent = price;
      document.getElementById('payment-section').classList.add('hidden');
      document.getElementById('download-section').classList.add('hidden');
      document.getElementById('uploadError').classList.add('hidden');
    };

    // Proceed to payment button
    document.getElementById('proceed-to-payment').onclick = function() {
      document.getElementById('escrow-section').classList.add('hidden');
      document.getElementById('payment-section').classList.remove('hidden');
    };

    // Payment form
    document.getElementById('opayPaymentForm').onsubmit = function(e) {
      e.preventDefault();
      const cardType = document.querySelector('#opayPaymentForm select[name="cardType"]').value;
      const cardNumber = document.querySelector('#opayPaymentForm input[name="cardNumber"]').value;
      const expiryDate = document.querySelector('#opayPaymentForm input[name="expiryDate"]').value;
      const cvv = document.querySelector('#opayPaymentForm input[name="cvv"]').value;

      // Simulate payment processing (in a real app, call Opay API)
      simulateOpayPayment(cardType, cardNumber, expiryDate, cvv, function(success) {
        if (success) {
          // Payment confirmed: release escrow and show download
          document.getElementById('payment-section').classList.add('hidden');
          document.getElementById('download-section').classList.remove('hidden');
          document.getElementById('download-title').textContent = escrowBook.title;
          document.getElementById('download-author').textContent = escrowBook.author;
          document.getElementById('download-price').textContent = escrowBook.price;
          // In a real app, upload the book file to your server and set the download link
          // For demo, show a simulated download (file is not actually uploaded)
          document.getElementById('download-link').addEventListener('click', function(e) {
            e.preventDefault();
            alert('Book download would start here. In a real app, the book file would be uploaded and available for download.');
          });
        } else {
          document.getElementById('paymentError').textContent = 'Payment failed. Please try again.';
          document.getElementById('paymentError').classList.remove('hidden');
        }
      });
    };

    function simulateOpayPayment(cardType, cardNumber, expiryDate, cvv, callback) {
      // Simulate payment processing
      setTimeout(function() {
        // For demo, always return success
        callback(true);
      }, 1000);
    }
  </script>
</body>
</html>
